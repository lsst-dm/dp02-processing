wmsServiceClass: desc.gen3_workflow.ParslService
parslConfig: desc.gen3_workflow.config.slurm_config

# Run in Singularity containers
commandPrepend: $DP02_ENV/dp02-tools/wrapper_singularity.sh

# CTRL_MPEXEC_DIR variable removed because of Singularity wrapper
runQuantumCommand: "pipetask {runPreCmdOpts} run -b {butlerConfig} -i {inCollection} -o {output} --output-run {outputRun} --qgraph {qgraphFile} --qgraph-id {qgraphId} --qgraph-node-id {qgraphNodeId} --clobber-outputs --skip-init-writes --extend-run {extraRunQuantumOptions}"

pipelineYaml: "${OBS_LSST_DIR}/pipelines/imsim/DRP.yaml#step2"

project: dp02
campaign: PREOPS-1145/step2_GNUM
submitPath: "${DP02_DIR}/submit/{outputRun}"
computeSite: ccin2p3
requestMemory: 3072
requestCpus: 1

includeConfigs:
  - requestMemory.yaml

payload:
  payloadName: 2.2i/runs/FRDF/DP0.2
  output: "{payloadName}/{campaign}"
  butlerConfig: /sps/lsst/dataproducts/rubin/previews/dp0.2/butler.yaml
  inCollection: "2.2i/defaults","2.2i/runs/FRDF/DP0.2/PREOPS-1145/step1"
  dataQuery: "instrument='LSSTCam-imSim' and skymap='DC2' and exposure >=LOWEXP and exposure <= HIGHEXP"

# Needed for Parsl plugin
executionButler:
  whenCreate: "PREPARE"
